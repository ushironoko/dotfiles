---
name: plan-review
description: Plan modeで作成したプランに対して任意のレビューエージェントを起動するスキル。reject時のコメント欄で使用し、専門家の視点からプランをレビューする。
---

# Plan Review

Plan modeで作成した最新のプランファイルに対して、指定したレビューエージェントを起動する。

## 前提条件

- Plan modeでプランファイルが作成済み
- レビューに使用するエージェントが `~/.claude/agents/` に定義済み

## 引数

| 引数       | 必須 | 説明                             |
| ---------- | ---- | -------------------------------- |
| agent-name | ○    | レビューに使用するエージェント名 |

## 実行フロー

### Phase 1: 引数解析

引数を解析する：

- 引数: エージェント名（必須）

引数が空または "help" の場合はヘルプを表示：

```
Usage: /plan-review <agent-name>

最新のPlanファイルを指定したエージェントでレビューします。

Arguments:
  agent-name : レビューに使用するエージェント名 (必須)

Examples:
  /plan-review rust-reviewer
  /plan-review similarity
  /plan-review pr-review-answer

Available agents:
  (~/.claude/agents/ 内のエージェント一覧を表示)
```

### Phase 2: 検証

1. **エージェントの存在確認**

   ```bash
   ls ~/.claude/agents/<agent-name>.md
   ```

   存在しない場合、利用可能なエージェント一覧を表示してエラー終了。

2. **最新Planファイルの自動検出**

   ```bash
   ls -t ./plans/*.md 2>/dev/null | head -1
   ```

   ファイルが見つからない場合はエラー終了。

### Phase 3: レビュー実行

1. **Planファイルの読み込み**

   Readツールで検出したファイルの内容を取得。

2. **エージェントの起動**

   Taskツールで指定されたサブエージェントを起動：

   ```
   subagent_type: <agent-name>
   prompt: |
     以下のPlanファイルをレビューしてください。
     あなたの専門知識に基づいて、以下の観点からフィードバックを提供してください：
     1. 技術的な正確性
     2. 潜在的な問題点やリスク
     3. 改善提案
     4. 見落とされている考慮事項

     ---

     Plan File: <path>

     ---

     <content>
   ```

### Phase 4: 結果報告

レビュー結果をユーザーに報告する。

## 利用可能エージェント

現在定義されているエージェント：

| エージェント名   | 用途                                       |
| ---------------- | ------------------------------------------ |
| rust-reviewer    | Rustコードのパフォーマンス・保守性レビュー |
| pr-review-answer | PRレビューコメント対応                     |
| similarity       | コード重複分析・リファクタリング提案       |

## 使用例

```
# PlanExitでreject後のコメント欄で:
> /plan-review rust-reviewer

最新Planファイルを検出: ./plans/kind-cuddling-dragon.md
エージェント: rust-reviewer

レビュー実行中...

=== レビュー結果 ===

[rust-reviewerからのフィードバック]

1. 技術的正確性:
   - ...

2. 潜在的問題点:
   - ...

3. 改善提案:
   - ...
```

## エラーハンドリング

| 状況                       | 対応                                        |
| -------------------------- | ------------------------------------------- |
| 引数なし                   | ヘルプを表示                                |
| エージェントが見つからない | 利用可能エージェント一覧を表示              |
| Planファイルが見つからない | plansディレクトリにファイルがないことを通知 |
| Taskツール実行失敗         | エラー内容を報告                            |

## Notes

- plansディレクトリは `./plans`（プロジェクトルート相対）
- **最新ファイルを自動検出**（ユーザーによるパス指定は不要）
- 任意のエージェントを指定可能
